<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>域名的设置 | 个人主页</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="学习总结">
    
    <link rel="preload" href="/assets/css/0.styles.e4f255b1.css" as="style"><link rel="preload" href="/assets/js/app.0897b9ab.js" as="script"><link rel="preload" href="/assets/js/2.32b4f8de.js" as="script"><link rel="preload" href="/assets/js/121.aac12bd4.js" as="script"><link rel="prefetch" href="/assets/js/10.6161357f.js"><link rel="prefetch" href="/assets/js/100.08a42a08.js"><link rel="prefetch" href="/assets/js/101.40ee6312.js"><link rel="prefetch" href="/assets/js/102.64887950.js"><link rel="prefetch" href="/assets/js/103.05eec7a5.js"><link rel="prefetch" href="/assets/js/104.d3d678c6.js"><link rel="prefetch" href="/assets/js/105.2e0204ae.js"><link rel="prefetch" href="/assets/js/106.9f449c38.js"><link rel="prefetch" href="/assets/js/107.89d14000.js"><link rel="prefetch" href="/assets/js/108.155ee0a2.js"><link rel="prefetch" href="/assets/js/109.d89952f0.js"><link rel="prefetch" href="/assets/js/11.8eb18d9e.js"><link rel="prefetch" href="/assets/js/110.fdd1273a.js"><link rel="prefetch" href="/assets/js/111.40f183a1.js"><link rel="prefetch" href="/assets/js/112.ab1e655c.js"><link rel="prefetch" href="/assets/js/113.7d620747.js"><link rel="prefetch" href="/assets/js/114.63c0ea0d.js"><link rel="prefetch" href="/assets/js/115.bc272ba3.js"><link rel="prefetch" href="/assets/js/116.be069044.js"><link rel="prefetch" href="/assets/js/117.f2cb4bc8.js"><link rel="prefetch" href="/assets/js/118.666c94d2.js"><link rel="prefetch" href="/assets/js/119.6f3553d9.js"><link rel="prefetch" href="/assets/js/12.d083859b.js"><link rel="prefetch" href="/assets/js/120.6acdfbdf.js"><link rel="prefetch" href="/assets/js/122.c0024756.js"><link rel="prefetch" href="/assets/js/123.1388f4ed.js"><link rel="prefetch" href="/assets/js/124.dd3ffd3e.js"><link rel="prefetch" href="/assets/js/125.27b9e720.js"><link rel="prefetch" href="/assets/js/126.01846dd8.js"><link rel="prefetch" href="/assets/js/127.cb7addf7.js"><link rel="prefetch" href="/assets/js/128.1cc6fac1.js"><link rel="prefetch" href="/assets/js/129.879851df.js"><link rel="prefetch" href="/assets/js/13.7a17938e.js"><link rel="prefetch" href="/assets/js/130.91f3e845.js"><link rel="prefetch" href="/assets/js/131.37551afe.js"><link rel="prefetch" href="/assets/js/132.0af4606b.js"><link rel="prefetch" href="/assets/js/133.fcac721c.js"><link rel="prefetch" href="/assets/js/134.936a0973.js"><link rel="prefetch" href="/assets/js/135.7fc24970.js"><link rel="prefetch" href="/assets/js/136.caaa193b.js"><link rel="prefetch" href="/assets/js/137.46cf1a5f.js"><link rel="prefetch" href="/assets/js/138.b1972460.js"><link rel="prefetch" href="/assets/js/139.30e503e4.js"><link rel="prefetch" href="/assets/js/14.1e13830e.js"><link rel="prefetch" href="/assets/js/140.b281c129.js"><link rel="prefetch" href="/assets/js/141.5c142706.js"><link rel="prefetch" href="/assets/js/142.af904b3f.js"><link rel="prefetch" href="/assets/js/143.26dfcd9e.js"><link rel="prefetch" href="/assets/js/144.16641598.js"><link rel="prefetch" href="/assets/js/145.e5ffb282.js"><link rel="prefetch" href="/assets/js/146.10bd31fb.js"><link rel="prefetch" href="/assets/js/147.be4de5d0.js"><link rel="prefetch" href="/assets/js/148.cca9f9af.js"><link rel="prefetch" href="/assets/js/149.273a6d22.js"><link rel="prefetch" href="/assets/js/15.dcac7eea.js"><link rel="prefetch" href="/assets/js/150.ef24a2eb.js"><link rel="prefetch" href="/assets/js/16.2dc5dd1f.js"><link rel="prefetch" href="/assets/js/17.fe8d6dc9.js"><link rel="prefetch" href="/assets/js/18.1c6b0951.js"><link rel="prefetch" href="/assets/js/19.5b3d92c1.js"><link rel="prefetch" href="/assets/js/20.0bba240e.js"><link rel="prefetch" href="/assets/js/21.120cdcb6.js"><link rel="prefetch" href="/assets/js/22.24933ab9.js"><link rel="prefetch" href="/assets/js/23.90910794.js"><link rel="prefetch" href="/assets/js/24.66e593c5.js"><link rel="prefetch" href="/assets/js/25.f9bc3f7e.js"><link rel="prefetch" href="/assets/js/26.a9d704d0.js"><link rel="prefetch" href="/assets/js/27.a3d9d27c.js"><link rel="prefetch" href="/assets/js/28.4dce43d3.js"><link rel="prefetch" href="/assets/js/29.93fcb8dd.js"><link rel="prefetch" href="/assets/js/3.68468d84.js"><link rel="prefetch" href="/assets/js/30.b0229cf7.js"><link rel="prefetch" href="/assets/js/31.51aa80ca.js"><link rel="prefetch" href="/assets/js/32.6f984b20.js"><link rel="prefetch" href="/assets/js/33.44faae93.js"><link rel="prefetch" href="/assets/js/34.24d4b777.js"><link rel="prefetch" href="/assets/js/35.b1f7787e.js"><link rel="prefetch" href="/assets/js/36.be44a88b.js"><link rel="prefetch" href="/assets/js/37.51541bfb.js"><link rel="prefetch" href="/assets/js/38.4d034f44.js"><link rel="prefetch" href="/assets/js/39.778a9ac9.js"><link rel="prefetch" href="/assets/js/4.715c5073.js"><link rel="prefetch" href="/assets/js/40.c1709a08.js"><link rel="prefetch" href="/assets/js/41.da8be7fc.js"><link rel="prefetch" href="/assets/js/42.e28f3958.js"><link rel="prefetch" href="/assets/js/43.2704ca37.js"><link rel="prefetch" href="/assets/js/44.633bb2cb.js"><link rel="prefetch" href="/assets/js/45.261db7c1.js"><link rel="prefetch" href="/assets/js/46.1bb0cd6e.js"><link rel="prefetch" href="/assets/js/47.6ddba031.js"><link rel="prefetch" href="/assets/js/48.08e93a13.js"><link rel="prefetch" href="/assets/js/49.1bd12a1d.js"><link rel="prefetch" href="/assets/js/5.ef50e827.js"><link rel="prefetch" href="/assets/js/50.9093ca4f.js"><link rel="prefetch" href="/assets/js/51.2bae90d4.js"><link rel="prefetch" href="/assets/js/52.842bd814.js"><link rel="prefetch" href="/assets/js/53.1ff35abe.js"><link rel="prefetch" href="/assets/js/54.154cb320.js"><link rel="prefetch" href="/assets/js/55.83bc9e19.js"><link rel="prefetch" href="/assets/js/56.ce8fb4a1.js"><link rel="prefetch" href="/assets/js/57.688d1800.js"><link rel="prefetch" href="/assets/js/58.16a74559.js"><link rel="prefetch" href="/assets/js/59.ed37c4f6.js"><link rel="prefetch" href="/assets/js/6.dc4eac3d.js"><link rel="prefetch" href="/assets/js/60.8e7f7416.js"><link rel="prefetch" href="/assets/js/61.6497c577.js"><link rel="prefetch" href="/assets/js/62.ea0f0394.js"><link rel="prefetch" href="/assets/js/63.af1a96c2.js"><link rel="prefetch" href="/assets/js/64.9a46e534.js"><link rel="prefetch" href="/assets/js/65.ae5faf99.js"><link rel="prefetch" href="/assets/js/66.eb3470e4.js"><link rel="prefetch" href="/assets/js/67.52c5ee17.js"><link rel="prefetch" href="/assets/js/68.090bd404.js"><link rel="prefetch" href="/assets/js/69.fa1bda6c.js"><link rel="prefetch" href="/assets/js/7.75e01e57.js"><link rel="prefetch" href="/assets/js/70.a65f45fa.js"><link rel="prefetch" href="/assets/js/71.f86555bc.js"><link rel="prefetch" href="/assets/js/72.93c558b0.js"><link rel="prefetch" href="/assets/js/73.276c80b7.js"><link rel="prefetch" href="/assets/js/74.ab59ea7b.js"><link rel="prefetch" href="/assets/js/75.5a330864.js"><link rel="prefetch" href="/assets/js/76.7c9e1c38.js"><link rel="prefetch" href="/assets/js/77.3eb96400.js"><link rel="prefetch" href="/assets/js/78.ea674f9e.js"><link rel="prefetch" href="/assets/js/79.c3a6cce6.js"><link rel="prefetch" href="/assets/js/8.f0f678d8.js"><link rel="prefetch" href="/assets/js/80.3936f401.js"><link rel="prefetch" href="/assets/js/81.45fd6a95.js"><link rel="prefetch" href="/assets/js/82.81ee1a62.js"><link rel="prefetch" href="/assets/js/83.1cf9cff3.js"><link rel="prefetch" href="/assets/js/84.fbb6f3b6.js"><link rel="prefetch" href="/assets/js/85.97407790.js"><link rel="prefetch" href="/assets/js/86.ce7dfd07.js"><link rel="prefetch" href="/assets/js/87.699c2c43.js"><link rel="prefetch" href="/assets/js/88.d9a0f822.js"><link rel="prefetch" href="/assets/js/89.37025171.js"><link rel="prefetch" href="/assets/js/9.1bbd6671.js"><link rel="prefetch" href="/assets/js/90.d0b07ba6.js"><link rel="prefetch" href="/assets/js/91.361981b1.js"><link rel="prefetch" href="/assets/js/92.43f39b96.js"><link rel="prefetch" href="/assets/js/93.4aeda11d.js"><link rel="prefetch" href="/assets/js/94.bf90d3b9.js"><link rel="prefetch" href="/assets/js/95.7e4b1af0.js"><link rel="prefetch" href="/assets/js/96.fef0c8f2.js"><link rel="prefetch" href="/assets/js/97.d8c8b2b0.js"><link rel="prefetch" href="/assets/js/98.2f51a1b2.js"><link rel="prefetch" href="/assets/js/99.7885470e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4f255b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="../assets/logo.png" alt="个人主页" class="logo"> <span class="site-name can-hide">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/error.html" class="nav-link">
  附录：错误码
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/error.html" class="nav-link">
  附录：错误码
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文档介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端杂记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%AE%B0/" aria-current="page" class="sidebar-link">不分类的前端相关知识点</a></li><li><a href="/前端杂记/angularJs脏值检查的原理.html" class="sidebar-link">angularjs脏值检查的原理</a></li><li><a href="/前端杂记/axios取消重复请求.html" class="sidebar-link">axios取消重复请求</a></li><li><a href="/前端杂记/base64的实现原理.html" class="sidebar-link">base64的实现原理</a></li><li><a href="/前端杂记/css不常用样式技巧汇总.html" class="sidebar-link">css不常用样式技巧汇总</a></li><li><a href="/前端杂记/document滚动相关的取值属性.html" class="sidebar-link">document滚动相关的取值属性</a></li><li><a href="/前端杂记/jsBridge.html" class="sidebar-link">jsBridge</a></li><li><a href="/前端杂记/nodemon的原理.html" class="sidebar-link">nodemon的原理</a></li><li><a href="/前端杂记/web_component.html" class="sidebar-link">web_component</a></li><li><a href="/前端杂记/关于mac的bash, zsh.html" class="sidebar-link">mac的bash_profile, zsh</a></li><li><a href="/前端杂记/关于meta的几点.html" class="sidebar-link">关于meta的几点</a></li><li><a href="/前端杂记/前端下载文件.html" class="sidebar-link">前端文件下载</a></li><li><a href="/前端杂记/前端实现超大文件上传.html" class="sidebar-link">前端实现大文件上传</a></li><li><a href="/前端杂记/前端引入第三js实践总结.html" class="sidebar-link">前端引入通过script引入js的几种方式</a></li><li><a href="/前端杂记/在线文件预览.html" class="sidebar-link">在线文件预览</a></li><li><a href="/前端杂记/域名的设置.html" class="active sidebar-link">域名的设置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/前端杂记/域名的设置.html#方案一-设置webpack的env-node-env变量" class="sidebar-link">方案一：设置webpack的env.NODE_ENV变量</a></li><li class="sidebar-sub-header"><a href="/前端杂记/域名的设置.html#方案二-代码执行期间动态读取window-location-host做区分" class="sidebar-link">方案二：代码执行期间动态读取window.location.host做区分</a></li></ul></li><li><a href="/前端杂记/如何获取localStorage已使用空间，以及最大存储空间.html" class="sidebar-link">如何获取localStorage已使用空间，以及最大存储空间</a></li><li><a href="/前端杂记/搭建环境react,webapck,typescript.html" class="sidebar-link">搭建环境react,webapck,typescript问题</a></li><li><a href="/前端杂记/每天一个浏览器API.html" class="sidebar-link">每天一个浏览器的API</a></li><li><a href="/前端杂记/疑难杂症的bug.html" class="sidebar-link">关于ios10.3.3的问题记录：cannot declare a let variable twice 'n'</a></li><li><a href="/前端杂记/虚拟dom，以及diff的理解.html" class="sidebar-link">虚拟dom，以及diff的理解</a></li><li><a href="/前端杂记/页面影藏元素的方式.html" class="sidebar-link">页面隐藏元素的方式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建工具篇-webpack等</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H5开发汇总</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web 安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http 协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>pwa</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器原理&amp;性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>babel</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3D探索</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="域名的设置"><a href="#域名的设置" class="header-anchor">#</a> 域名的设置</h1> <p>项目开发中会有多种代码环境，开发环境dev，测试环境test，生成环境production，每个环境对应的接口域名又有不同，因此前端需要动态配置设置接口域名。</p> <h2 id="方案一-设置webpack的env-node-env变量"><a href="#方案一-设置webpack的env-node-env变量" class="header-anchor">#</a> 方案一：设置webpack的env.NODE_ENV变量</h2> <p>具体步骤介绍：在使用webpack进行项目构建打包的时候,一般会执行npm run dev，或者npm start等命令，他们对应就是package.json中的script命令。</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;scripts&quot;: {
   &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
   &quot;dev&quot;: &quot;webpack-dev-server --open --env.NODE_ENV=development&quot;,
   &quot;build:pro&quot;: &quot;webpack --env.NODE_ENV=production &amp;&amp; node server.js&quot;,
   &quot;build:stage&quot;: &quot;webpack --env.NODE_ENV=stage &amp;&amp; node server.js&quot;,
   &quot;build:test&quot;: &quot;webpack --env.NODE_ENV=test &amp;&amp; node server.js&quot;
  },
</code></pre></div><p>如上所示如果设置了  --env.NODE_ENV= ***  ， 那么我们就可以在我们的代码中获取这个值，因此可以利用这个值取做进一步的区分（例如：进行webpack 配置区分，域名区分）。</p> <p>1）webpack 的区分配置</p> <p>为了开发舒畅，开发环境，生产环境的webpack配置有不同的，生产环境一般会开启很多功能例 如调试，代码压缩，合并，缓存优化。所有一般会在webapck.config.js中读取[env.NODE_ENV]来进行区分。</p> <div class="language- extra-class"><pre class="language-text"><code>let webpackConfig = {
  &quot;development&quot;: require('./webpack/webpack.dev.js'),
  &quot;production&quot;: require('./webpack/webpack.pro'),
  &quot;stage&quot;: require('./webpack/webpack.stage'),
  &quot;test&quot;: require('./webpack/webpack.test'),
}
module.exports = env =&gt; {
  return webpackConfig[env.NODE_ENV]
}
</code></pre></div><p>2）域名的区分</p> <p>如果设置了 --env.NODE_ENV= ***，我们可以在前端代码中读取变量process.env.NODE_ENV，用它来获取我们这是的值。</p> <div class="language- extra-class"><pre class="language-text"><code>if (process.env.NODE_ENV === 'development') {
	host = 'http://dev.swic.com/'
} else if (process.env.NODE_ENV === 'production') {
	host = 'http://pro.swic.com'
}
</code></pre></div><p>项目实例：<a href="https://github.com/EvalGitHub/webpack_reactJS" target="_blank" rel="noopener noreferrer">https://github.com/EvalGitHub/webpack_reactJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>本方案缺陷：</strong></p> <p>上面的方案确实可行，但是缺陷是每一次发版针对不同环境，都需要开发人员手动在线下针对不同环境执行不同的命令打包代码，然后发布，存在很大的风险（命令执行错误，代码的更改）。</p> <h2 id="方案二-代码执行期间动态读取window-location-host做区分"><a href="#方案二-代码执行期间动态读取window-location-host做区分" class="header-anchor">#</a> 方案二：代码执行期间动态读取window.location.host做区分</h2> <p>因为不同环境域名有所不同，因此可以在代码执行期间使用window.location.host获取不同的域名做代码区分。</p> <div class="language- extra-class"><pre class="language-text"><code>let baseHost = location.protocol + '//' + location.hostname + ':8081/****';  // 默认
const proDomain = {
	dev: 'lending.tudou.com',
	test: 'lending.test.tudou.com',
	production: 'lending.production.tudou.com'
};

for (let key in proDomain  ) {
	if ( proDomain[key] === window.loaction.host) {
		baseHost  = location.protocol + '//' + proDomain [key]
	}
}
export default { baseHost }
</code></pre></div><p>项目实例：</p> <p><a href="https://github.com/EvalGitHub/lond.frontend.code/blob/master/src/service/webApi.js" target="_blank" rel="noopener noreferrer">https://github.com/EvalGitHub/lond.frontend.code/blob/master/src/service/webApi.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>本方案缺陷：</strong></p> <p>因为使用了window对象，所以限制了只能在浏览器环境执行，因此只使用与web，H5项目。</p> <h4 id="方案三-运维开发人员在发布环境设置环境变量-前端同学读取使用"><a href="#方案三-运维开发人员在发布环境设置环境变量-前端同学读取使用" class="header-anchor">#</a> 方案三：运维开发人员在发布环境设置环境变量，前端同学读取使用</h4> <p>现在前端开发都离不开nodeJS，使用nodeJS（express/koa）可以一个微服务启动打包好的前端项目。</p> <p>例如运维同学设置了一个process.env.front_env的环境变量，这样我们就可在我们的前端项目启动文件server.js中读取这个值（只能在nodeJS中读取，在前端项目代码块中是无法读取这个值的）</p> <div class="language- extra-class"><pre class="language-text"><code>const express = require('express');
const app = express();
const env = process.env.front_env || 'development';
const initialContent = {
  development: 'development',
  production: 'production',
  staging: 'staging',
  test: 'test'
};
app.use(express.static('./dist'));
app.get('/config', function(req, res){
  res.json(initialContent[env]);
});

function startApp () {
  app.listen(5000,function(err){
    if(err){
      console.log(err);
      return;
    }
    console.log('&gt; Listening at  http://localhost: '+ 5000 + '\n')
  });
};
startApp();
</code></pre></div><p>上面的代码就是使用express启动打包 好的前端项目，同时还设置了一个路由'./config'，用来返回环境变量（如果运维在各个不同环境有设置环境变量process.env.front_env）。</p> <p>在前端使用：</p> <div class="language- extra-class"><pre class="language-text"><code>import axios from 'axios';

const DomainConfig = {
    development: {
        env: 'development',
        host: 'https://dev-api-ezbuy.codemao.cn/',
        openService: 'https://dev-open-service.codemao.cn/',
        port: 0,
        fontWebSiteHost: 'https://dev-transaction-cashier.codemao.cn/',
        // fontWebSiteHost: 'http://192.168.0.6:9004/',
    },
    production: {
        env: 'production',
        host: 'https://production-api-ezbuy.codemao.cn/',
        openService: 'https://open-service.codemao.cn/',
        port: 0,
        fontWebSiteHost: 'https://production-transaction-cashier.codemao.cn/'
    },
};

let config = '';
export const init_config = (cb) =&gt; {
    return axios.get('/config').then((res) =&gt; {
        if (res.status === 200) {
            let env = res.data;
            config = DomainConfig[env];
            cb &amp;&amp; cb();
            return config;
        } 
    }).catch(err =&gt; {
        config = DomainConfig.development;
        cb &amp;&amp; cb();
        return config;
    })
}

export const get_config = () =&gt; {
    if (!config) {
        console.error(`
            Tried to get config before it was loaded. This should never happen.
            Ensure your code is not run before the index.ts init function has been called.
            Be aware that the config is not accessible from within the WHITEPAW Runtime.
        `);
        return;
    }
    return config;
};

</code></pre></div><p>于是在进行接口访问的时候就可以使用get_config() 获取相关配置，值得提醒的是必须保证init_config()，在get_config()之前执行，因此init_config(cb)，这个cb回掉函数是必要的，通常是app.js单页初始化函数。</p> <div class="language- extra-class"><pre class="language-text"><code>function startRenderDom () {
  ReactDOM.render(
    &lt;App/&gt;,
    document.getElementById('root')
  );
};
init_config(startRenderDom);
</code></pre></div><p>参考实例：<a href="https://github.com/EvalGitHub/cashier/blob/master/src/index.js" target="_blank" rel="noopener noreferrer">https://github.com/EvalGitHub/cashier/blob/master/src/index.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/11/2021, 1:10:37 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/前端杂记/在线文件预览.html" class="prev">
        在线文件预览
      </a></span> <span class="next"><a href="/前端杂记/如何获取localStorage已使用空间，以及最大存储空间.html">
        如何获取localStorage已使用空间，以及最大存储空间
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0897b9ab.js" defer></script><script src="/assets/js/2.32b4f8de.js" defer></script><script src="/assets/js/121.aac12bd4.js" defer></script>
  </body>
</html>
